---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

# chemspideR

> `R` functionalities for ChemSpider's new API services

ChemSpider has introduced a new API syntax in late 2018, and [the old ChemSpider API syntax will be shut down at the end of November 2018](http://link.rsc.org/rsps/m/xSq8Cm8ovjN8-Elm0eYB3Sey61zutqNIUUaMcyc14sQ). `chemspideR` provides `R` wrappers around the new API services from ChemSpider. 

The aim of this package is to:

1) Translate the new ChemSpider API services into `R`-friendly functions.
2) Include thorough quality checking *before* the query is send, to avoid using up the query quota on, e.g., spelling errors.
3) Implement the `R` functionality in a way that is suitable for both `base` and `tidyverse` programming.
4) Provide (non-ChemSpider) convenience functions to complement the functionality.

The `chemspideR` package is platform independent, but requires a valid ChemSpider API key. While the `chemspideR` package does *not* provide any tools to securely store and access the API key, a look into the excellent [`keyring`](https://github.com/r-lib/keyring) package is recommended. To "remember" the results of API queries (i.e., to not ruin the API allowance),  [`memoise`](https://github.com/r-lib/memoise) is recommended. Finally, any rate limitations can be created with functionalities from [`ratelimitr`](https://github.com/tarakc02/ratelimitr).

## Coverage

As of `r Sys.Date()`, the following functionalities are implemented (`r signif((25 / 25) * 100, digits = 2)`% functionality with `r signif((27 / 27) * 100, digits = 2)`% annotation):

**FILTERING**

| ChemSpider Compound API                  | `chemspideR` Wrapper                      | `chemspideR` Help File |
|:---------------------------------------- |:----------------------------------------- |:----------------------:|
| filter-element-post                      | `chemspideR::post_element()`              | yes                    |
| filter-formula-batch-post                | `chemspideR::post_formula_batch()`        | yes                    |
| filter-formula-batch-queryId-results-get | `chemspideR::get_formula_batch_results()` | yes                    |
| filter-formula-batch-queryId-status-get  | `chemspideR::get_formula_batch_status()`  | yes                    |
| filter-formula-post                      | `chemspideR::post_formula()`              | yes                    |
| filter-inchi-post                        | `chemspideR::post_inchi()`                | yes                    |
| filter-inchikey-post                     | `chemspideR::post_inchikey()`             | yes                    |
| filter-intrinsicproperty-post            | `chemspideR::post_intrinsic_property()`   | yes                    |
| filter-mass-batch-post                   | `chemspideR::post_mass_batch()`           | yes                    |
| filter-mass-batch-queryId-results-get    | `chemspideR::get_mass_batch_results()`    | yes                    |
| filter-mass-batch-queryId-status-get     | `chemspideR::get_mass_batch_status()`     | yes                    |
| filter-mass-post                         | `chemspideR::post_mass()`                 | yes                    |
| filter-name-post                         | `chemspideR::post_name()`                 | yes                    |
| filter-queryId-results-get               | `chemspideR::get_results()`               | yes                    |
| filter-queryId-results-sdf-get           | `chemspideR::get_sdf()` *                 | yes                    |
| filter-queryId-status-get                | `chemspideR::get_status()`                | yes                    |
| filter-smiles-post                       | `chemspideR::post_smiles()`               | yes                    |

\* `chemspideR::get_sdf()` downloads the gzipped base64-encoded character string, but there is currently no implementation for accessing the (multiple) .mol files contained inside.

**LOOKUPS**

| ChemSpider Compound API | `chemspideR` Wrapper             | `chemspideR` Help File |
|:----------------------- |:-------------------------------- |:----------------------:|
| lookups-datasources-get | `chemspideR::get_data_sources()` | yes                    |

**RECORDS**

| ChemSpider Compound API                 | `chemspideR` Wrapper                    | `chemspideR` Help File |
|:--------------------------------------- |:--------------------------------------- |:----------------------:|
| records-batch-post                      | `chemspideR::post_batch()`              | yes                    |
| records-recordId-details-get            | `chemspideR::get_details()`             | yes                    |
| records-recordId-externalreferences-get | `chemspideR::get_external_references()` | yes                    |
| records-recordId-image-get              | `chemspideR::get_image()`               | yes                    |
| records-recordId-mol-get                | `chemspideR::get_mol()`                 | yes                    |

**TOOLS**

| ChemSpider Compound API      | `chemspideR` Wrapper                   | `chemspideR` Help File |
|:---------------------------- |:-------------------------------------- |:----------------------:|
| tools-convert-post           | `chemspideR::post_convert()`           | yes                    |
| tools-validate-inchikey-post | `chemspideR::post_validate_inchikey()` | yes                    |

**WRITING (`chemspideR` EXCLUSIVE)**

| ChemSpider Compound API | `chemspideR` Wrapper        | `chemspideR` Help File |
|:----------------------- |:--------------------------- |:----------------------:|
|                         | `chemspideR::write_image()` | yes                    |
|                         | `chemspideR::write_mol()`   | yes                    |

## Installation

### Dependencies

This packages relies on two essential dependencies, namely `curl` and `jsonlite`. Additional (but not crucial) functionality for handling images is coming from the `png` package.

If not already installed, these packages *should* be installed automatically when installing `chemspideR`. Should this result in trouble, the dependency packages can be installed manually:

```{r, eval=FALSE}
install.packages(c("curl", "jsonlite", "png"))
```

If `curl` and/or `jsonlite` are missing from the R library, all functions of `chemspideR` will throw an error.

### R package

Install the package from GitHub (using `devtools`):

```{r,eval=FALSE}
# install.packages("devtools")
devtools::install_github("NIVANorge/chemspideR")
```

Currently the only tested environment for `chemspideR` is Windows 10, but it *should* install smoothly on macOS and Linux distributions as well. Please open an issue if you run into any troubles. 

## Best practices for ChemSpider's Compound APIs

This section will be updated with practical examples in the future.

The basic workflow order for the above **FILTERING** queries is: 

1) POST Query

2) GET Status

3) GET Results (after GET Status returns `"Complete"`)

In practice, this means the following possivle workflows can be implemented:

| POST Query                              | GET Status                               | GET Result                                |
:---------------------------------------- |:---------------------------------------- |:----------------------------------------- |
| `chemspideR::post_element()`            | `chemspideR::get_status()`               | `chemspideR::get_results()`               |
| `chemspideR::post_formula()`            | `chemspideR::get_status()`               | `chemspideR::get_results()`               |
| `chemspideR::post_formula_batch()`      | `chemspideR::get_formula_batch_status()` | `chemspideR::get_formula_batch_results()` |
| `chemspideR::post_inchi()`              | `chemspideR::get_status()`               | `chemspideR::get_results()`               |
| `chemspideR::post_inchikey()`           | `chemspideR::get_status()`               | `chemspideR::get_results()`               |
| `chemspideR::post_intrinsic_property()` | `chemspideR::get_status()`               | `chemspideR::get_results()`               |
| `chemspideR::post_mass()`               | `chemspideR::get_status()`               | `chemspideR::get_results()`               |
| `chemspideR::post_mass_batch()`         | `chemspideR::get_mass_batch_status()`    | `chemspideR::get_mass_batch_results()`    |
| `chemspideR::post_mass()`               | `chemspideR::get_status()`               | `chemspideR::get_results()`               |
| `chemspideR::post_name()`               | `chemspideR::get_status()`               | `chemspideR::get_results()`               |
| `chemspideR::post_smiles()`             | `chemspideR::get_status()`               | `chemspideR::get_results()`               |

Typically, the result will be one or multiple ChemSpider IDs (`recordId`). They can be used as  input into the above **RECORDS** queries.

## Funding

This package was created at the [Norwegian Institute for Water Research (*norsk institutt for vannforskning*; NIVA)](https://www.niva.no/en) in conjunction with NIVA's Computational Toxicology Program (NCTP) at NIVA's Section for Ecotoxicology and Risk Assessment and funded by [The Research Council of Norway (RCN)](https://www.forskningsradet.no/en/Home_page/1177315753906), project 268404: Cumulative Hazard and Risk Assessment of Complex Mixtures and Multiple Stressors (MixRisk).

## License

MIT Â© Raoul Wolf
